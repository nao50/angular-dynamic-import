{"ast":null,"code":"import _asyncToGenerator from \"/Users/nao/nodejs/angular-dynamic-import/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport { ViewContainerRef } from '@angular/core';\nimport { BlueComponent } from './blue/blue.component';\nimport { RedComponent } from './red/red.component';\nimport { YellowComponent } from './yellow/yellow.component';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"./services/widget.service\";\nimport * as i2 from \"@angular/router\";\nconst _c0 = [\"dynamic\"];\nconst _c1 = [\"dynamic2\"];\nexport class AppComponent {\n  constructor(widgetService, resolver, renderer) {\n    this.widgetService = widgetService;\n    this.resolver = resolver;\n    this.renderer = renderer;\n  }\n\n  ngOnInit() {\n    this.listWidgets(); // const aaa = this.loadDynamicComponent('blue');\n    // console.log('aaa:', aaa)\n\n    this.blueFactory = this.resolver.resolveComponentFactory(BlueComponent);\n    this.redFactory = this.resolver.resolveComponentFactory(RedComponent);\n    this.yellowFactory = this.resolver.resolveComponentFactory(YellowComponent);\n  }\n\n  listWidgets() {\n    this.widgetService.listWidgets('assets/widgets.json').subscribe(widgets => {\n      // console.log(data)\n      widgets.forEach(widget => {\n        this.loadDynamicComponentWithComponentFactoryResolver(widget);\n      });\n    });\n  }\n\n  createComponent(type) {\n    const r = Math.floor(Math.random() * 100);\n    this.loadDynamicComponentWithComponentFactoryResolver({\n      type: type,\n      title: '',\n      x: Math.floor(Math.random() * 100),\n      y: Math.floor(Math.random() * 100),\n      width: Math.floor(Math.random() * 100),\n      height: Math.floor(Math.random() * 100)\n    });\n  }\n\n  loadDynamicComponentWithComponentFactoryResolver(widget) {\n    switch (widget.type) {\n      case \"blue\":\n        const blueComponentRef = this.viewContainerRef.createComponent(this.blueFactory);\n        blueComponentRef.instance.widget = widget;\n        break;\n\n      case \"red\":\n        const redComponentRef = this.viewContainerRef.createComponent(this.redFactory);\n        redComponentRef.instance.widget = widget;\n        break;\n\n      case \"yellow\":\n        const yellowComponentRef = this.viewContainerRef.createComponent(this.yellowFactory);\n        yellowComponentRef.instance.widget = widget;\n        break;\n\n      default:\n        return;\n    }\n  } // loadDynamicComponent(type: string): any {\n\n\n  loadDynamicComponent(type) {\n    var _this = this;\n\n    return _asyncToGenerator(function* () {\n      // const widgetModule = await import(`./${type}/${type}.module`)\n      // return new widgetModule.BlueModule.BlueComponent\n      // const widgetModule = await import(`./blue/blue.module`)\n      const widgetModule = yield import(`./blue/blue.component`);\n      const hoge = new widgetModule.BlueComponent();\n\n      let blue = _this.renderer.createElement('app-blue');\n\n      _this.renderer.setStyle(blue, 'width', '150px');\n\n      _this.renderer.appendChild(_this.dynamic2.nativeElement, blue); //\n      // let btn = this.renderer.createElement('button');\n      // let text = this.renderer.createText('ボタン作成');\n      // this.renderer.setAttribute(btn, 'name', 'btnName');\n      // this.renderer.addClass(btn, 'className');\n      // this.renderer.setStyle(btn, 'width', '150px');\n      // this.renderer.appendChild(btn, text);\n      // this.renderer.appendChild(this.dynamic2.nativeElement, btn);\n\n    })();\n  }\n\n}\n\nAppComponent.ɵfac = function AppComponent_Factory(t) {\n  return new (t || AppComponent)(i0.ɵɵdirectiveInject(i1.WidgetService), i0.ɵɵdirectiveInject(i0.ComponentFactoryResolver), i0.ɵɵdirectiveInject(i0.Renderer2));\n};\n\nAppComponent.ɵcmp = /*@__PURE__*/i0.ɵɵdefineComponent({\n  type: AppComponent,\n  selectors: [[\"app-root\"]],\n  viewQuery: function AppComponent_Query(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵviewQuery(_c0, 5, ViewContainerRef);\n      i0.ɵɵviewQuery(_c1, 5);\n    }\n\n    if (rf & 2) {\n      let _t;\n\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.viewContainerRef = _t.first);\n      i0.ɵɵqueryRefresh(_t = i0.ɵɵloadQuery()) && (ctx.dynamic2 = _t.first);\n    }\n  },\n  decls: 17,\n  vars: 0,\n  consts: [[1, \"m-24\", \"flex\", \"flex-wrap\", \"gap-x-2\", \"justify-center\"], [1, \"py-2\", \"px-4\", \"border\", \"border-transparent\", \"shadow-sm\", \"text-sm\", \"font-medium\", \"rounded-md\", \"text-white\", \"bg-gray-500\", \"hover:bg-gray-700\", 3, \"click\"], [1, \"m-24\", \"flex\", \"gap-x-2\", \"justify-center\"], [1, \"py-2\", \"px-4\", \"border\", \"border-transparent\", \"shadow-sm\", \"text-sm\", \"font-medium\", \"rounded-md\", \"text-white\", \"bg-blue-400\", \"hover:bg-blue-600\", 3, \"click\"], [1, \"py-2\", \"px-4\", \"border\", \"border-transparent\", \"shadow-sm\", \"text-sm\", \"font-medium\", \"rounded-md\", \"text-white\", \"bg-yellow-400\", \"hover:bg-yellow-600\", 3, \"click\"], [1, \"py-2\", \"px-4\", \"border\", \"border-transparent\", \"shadow-sm\", \"text-sm\", \"font-medium\", \"rounded-md\", \"text-white\", \"bg-red-400\", \"hover:bg-red-600\", 3, \"click\"], [1, \"p-24\", \"flex\", \"relative\", \"justify-center\", \"gap-x-2\", \"border-2\"], [1, \"h-96\", \"w-auto\"], [\"dynamic\", \"\"], [\"dynamic2\", \"\"]],\n  template: function AppComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ɵɵelementStart(0, \"div\", 0);\n      i0.ɵɵelementStart(1, \"button\", 1);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_1_listener() {\n        return ctx.loadDynamicComponent(\"blue\");\n      });\n      i0.ɵɵtext(2, \" Add Random Component \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(3, \"div\", 2);\n      i0.ɵɵelementStart(4, \"button\", 3);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_4_listener() {\n        return ctx.createComponent(\"blue\");\n      });\n      i0.ɵɵtext(5, \" Add Blue Component with Factory \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(6, \"button\", 4);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_6_listener() {\n        return ctx.createComponent(\"yellow\");\n      });\n      i0.ɵɵtext(7, \" Add Yellow Component \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(8, \"button\", 5);\n      i0.ɵɵlistener(\"click\", function AppComponent_Template_button_click_8_listener() {\n        return ctx.createComponent(\"red\");\n      });\n      i0.ɵɵtext(9, \" Add Red Component \");\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementStart(10, \"div\", 6);\n      i0.ɵɵelementStart(11, \"div\", 7);\n      i0.ɵɵelement(12, \"div\", null, 8);\n      i0.ɵɵelementEnd();\n      i0.ɵɵelementEnd();\n      i0.ɵɵelement(14, \"div\", null, 9);\n      i0.ɵɵelement(16, \"router-outlet\");\n    }\n  },\n  directives: [i2.RouterOutlet],\n  styles: [\"\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IiIsImZpbGUiOiJhcHAuY29tcG9uZW50LnNjc3MifQ== */\"]\n});","map":{"version":3,"sources":["/Users/nao/nodejs/angular-dynamic-import/src/app/app.component.ts","/Users/nao/nodejs/angular-dynamic-import/src/app/app.component.html"],"names":[],"mappings":"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","sourcesContent":["import { Component, ComponentFactory, ComponentFactoryResolver, OnInit, ViewChild, ViewContainerRef, Renderer2, ElementRef } from '@angular/core';\nimport { WidgetService, Widget } from './services/widget.service';\nimport { BlueComponent } from './blue/blue.component';\nimport { RedComponent } from './red/red.component';\nimport { YellowComponent } from './yellow/yellow.component';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: './app.component.html',\n  styleUrls: ['./app.component.scss']\n})\nexport class AppComponent implements OnInit {\n  blueFactory!: ComponentFactory<BlueComponent>;\n  redFactory!: ComponentFactory<RedComponent>;\n  yellowFactory!: ComponentFactory<YellowComponent>;\n  @ViewChild('dynamic', { read: ViewContainerRef }) viewContainerRef!: ViewContainerRef;\n  @ViewChild('dynamic2') dynamic2!: ElementRef;\n\n\n  constructor(\n    private widgetService: WidgetService,\n    private resolver: ComponentFactoryResolver,\n    private renderer: Renderer2\n  ) {}\n\n  ngOnInit(): void {\n    this.listWidgets()\n\n    // const aaa = this.loadDynamicComponent('blue');\n    // console.log('aaa:', aaa)\n\n    this.blueFactory = this.resolver.resolveComponentFactory(BlueComponent);\n    this.redFactory = this.resolver.resolveComponentFactory(RedComponent);\n    this.yellowFactory = this.resolver.resolveComponentFactory(YellowComponent);\n  }\n\n  listWidgets() {\n    this.widgetService.listWidgets('assets/widgets.json').subscribe(widgets => {\n      // console.log(data)\n      widgets.forEach(widget => {\n        this.loadDynamicComponentWithComponentFactoryResolver(widget);\n      })\n    });\n  }\n\n  createComponent(type: string): void {\n    const r = Math.floor(Math.random() * 100);\n    this.loadDynamicComponentWithComponentFactoryResolver({\n      type: type,\n      title: '',\n      x: Math.floor(Math.random() * 100),\n      y: Math.floor(Math.random() * 100),\n      width: Math.floor(Math.random() * 100),\n      height: Math.floor(Math.random() * 100)\n    });\n  }\n\n  loadDynamicComponentWithComponentFactoryResolver(widget?: Widget): void {\n    switch (widget!.type) {\n      case \"blue\":\n        const blueComponentRef = this.viewContainerRef.createComponent(this.blueFactory);\n        blueComponentRef.instance.widget = widget!\n        break;\n      case \"red\":\n        const redComponentRef = this.viewContainerRef.createComponent(this.redFactory);\n        redComponentRef.instance.widget = widget!\n        break;\n      case \"yellow\":\n        const yellowComponentRef = this.viewContainerRef.createComponent(this.yellowFactory);\n        yellowComponentRef.instance.widget = widget!\n        break;\n      default:\n        return\n    }\n  }\n\n  // loadDynamicComponent(type: string): any {\n  async loadDynamicComponent(type: string): Promise<any> {\n    // const widgetModule = await import(`./${type}/${type}.module`)\n    // return new widgetModule.BlueModule.BlueComponent\n\n    // const widgetModule = await import(`./blue/blue.module`)\n    const widgetModule = await import(`./blue/blue.component`)\n    const hoge = new widgetModule.BlueComponent\n\n\n\n    let blue = this.renderer.createElement('app-blue');\n    this.renderer.setStyle(blue, 'width', '150px');\n    this.renderer.appendChild(this.dynamic2.nativeElement, blue);\n\n    //\n    // let btn = this.renderer.createElement('button');\n    // let text = this.renderer.createText('ボタン作成');\n\n    // this.renderer.setAttribute(btn, 'name', 'btnName');\n    // this.renderer.addClass(btn, 'className');\n    // this.renderer.setStyle(btn, 'width', '150px');\n\n    // this.renderer.appendChild(btn, text);\n    // this.renderer.appendChild(this.dynamic2.nativeElement, btn);\n  }\n\n}\n\n","<div class=\"m-24 flex flex-wrap gap-x-2 justify-center\">\n  <button\n    class=\"\n      py-2\n      px-4\n      border border-transparent\n      shadow-sm\n      text-sm\n      font-medium\n      rounded-md\n      text-white\n      bg-gray-500\n      hover:bg-gray-700\n    \"\n    (click)=\"loadDynamicComponent('blue')\"\n  >\n    Add Random Component\n  </button>\n</div>\n\n<div class=\"m-24 flex gap-x-2 justify-center\">\n  <button\n    class=\"\n      py-2\n      px-4\n      border border-transparent\n      shadow-sm\n      text-sm\n      font-medium\n      rounded-md\n      text-white\n      bg-blue-400\n      hover:bg-blue-600\n    \"\n    (click)=\"createComponent('blue')\"\n  >\n    Add Blue Component with Factory\n  </button>\n\n  <button\n    class=\"\n      py-2\n      px-4\n      border border-transparent\n      shadow-sm\n      text-sm\n      font-medium\n      rounded-md\n      text-white\n      bg-yellow-400\n      hover:bg-yellow-600\n    \"\n    (click)=\"createComponent('yellow')\"\n  >\n    Add Yellow Component\n  </button>\n\n  <button\n    class=\"\n      py-2\n      px-4\n      border border-transparent\n      shadow-sm\n      text-sm\n      font-medium\n      rounded-md\n      text-white\n      bg-red-400\n      hover:bg-red-600\n    \"\n    (click)=\"createComponent('red')\"\n  >\n    Add Red Component\n  </button>\n</div>\n\n<div class=\"p-24 flex relative justify-center gap-x-2 border-2\">\n  <div class=\"h-96 w-auto\">\n    <div #dynamic></div>\n  </div>\n</div>\n\n<div #dynamic2></div>\n\n<router-outlet></router-outlet>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}